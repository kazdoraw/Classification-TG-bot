# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π

## –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

‚úÖ **Conda environment:** `ml-python312`  
‚úÖ **Path:** `/opt/anaconda3/envs/ml-python312`  
‚úÖ **Python:** 3.12 (—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏)

## –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è

–í—Å–µ –º–æ–¥–µ–ª–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è **–±—ã—Å—Ç—Ä–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è**:

| –ú–æ–¥–µ–ª—å | Epochs | Batch Size | –í—Ä–µ–º—è (–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ) |
|--------|--------|------------|------------------------|
| ResNet-18 ‚≠ê | 15 | 32 | ~15-30 –º–∏–Ω—É—Ç |
| Baseline CNN | 20 | 32 | ~20-40 –º–∏–Ω—É—Ç |
| ViT-B/16 | 10 | 16 | ~30-60 –º–∏–Ω—É—Ç |

**Early stopping:** –û–±—É—á–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ä–∞–Ω—å—à–µ, –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç —É–ª—É—á—à–∞—Ç—å—Å—è (patience: 4-7 epochs)

---

## –í–∞—Ä–∏–∞–Ω—Ç 1: –ë—ã—Å—Ç—Ä–æ–µ –æ–±—É—á–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ ResNet-18)

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∞–ª–∞** - –æ–±—É—á–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é –º–æ–¥–µ–ª—å:

```bash
./train_resnet_fast.sh
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç –æ–±—É—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ ResNet-18 (–æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞).

**–í—Ä–µ–º—è:** ~15-30 –º–∏–Ω—É—Ç

---

## –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π

–û–±—É—á–∏—Ç—å –≤—Å–µ 3 –º–æ–¥–µ–ª–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ + —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ:

```bash
./train_all_models.sh
```

–°–∫—Ä–∏–ø—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç:
1. ResNet-18 (15 epochs)
2. Baseline CNN (20 epochs)
3. ViT-B/16 (10 epochs) - –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å (Ctrl+C)
4. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

**–í—Ä–µ–º—è:** ~1-2 —á–∞—Å–∞ (–∏–ª–∏ ~45 –º–∏–Ω—É—Ç –±–µ–∑ ViT)

---

## –í–∞—Ä–∏–∞–Ω—Ç 3: –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –º–æ–¥–µ–ª–∏ –≤—Ä—É—á–Ω—É—é:

```bash
# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
conda activate ml-python312

# –û–±—É—á–∏—Ç—å ResNet-18 (–æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å)
python src/train_primary_resnet18.py

# –û–±—É—á–∏—Ç—å Baseline CNN (–¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)
python src/train_primary_baseline_cnn.py

# –û–±—É—á–∏—Ç—å ViT (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
python src/train_primary_vit.py

# –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
python src/compare_primary_models.py
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞—Ç–∞—Å–µ—Ç—ã –≥–æ—Ç–æ–≤—ã:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
ls -la data/primary/train/
ls -la data/primary/val/

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–∞–ø–∫–∏: retina, blood, scene
# Train: 352 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (32+160+160)
# Val: 88 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (8+40+40)
```

–ï—Å–ª–∏ –¥–∞—Ç–∞—Å–µ—Ç—ã –Ω–µ –≥–æ—Ç–æ–≤—ã:

```bash
python organize_datasets.py
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—É—á–µ–Ω–∏—è

–í–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è –≤—ã —É–≤–∏–¥–∏—Ç–µ:
- –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —ç–ø–æ—Ö–∞–º (progress bar)
- –ú–µ—Ç—Ä–∏–∫–∏: loss, accuracy, F1-score
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏
- Early stopping –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç —É–ª—É—á—à–∞—Ç—å—Å—è

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
Epoch 5/15
--------------------------------------------------
Training: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 11/11 [00:15<00:00]
Validation: 100%|‚ñà‚ñà‚ñà‚ñà| 3/3 [00:02<00:00]
Train - Loss: 0.3245, Acc: 0.8920, F1: 0.8876
Val   - Loss: 0.4123, Acc: 0.8523, F1: 0.8445
‚úì New best model saved! Val Acc: 0.8523
```

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±—É—á–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```
models/
‚îú‚îÄ‚îÄ resnet18/
‚îÇ   ‚îú‚îÄ‚îÄ best_model.pth           ‚Üê –û–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ confusion_matrix.png     ‚Üê –ì–¥–µ –º–æ–¥–µ–ª—å –æ—à–∏–±–∞–µ—Ç—Å—è
‚îÇ   ‚îî‚îÄ‚îÄ training_history.png     ‚Üê –ì—Ä–∞—Ñ–∏–∫–∏ –æ–±—É—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ baseline_cnn/
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ vit/
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ model_comparison.png         ‚Üê –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
```

---

## –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã

### –û—à–∏–±–∫–∞: ModuleNotFoundError

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

```bash
conda activate ml-python312
pip install torch torchvision scikit-learn matplotlib seaborn tqdm
```

### –û—à–∏–±–∫–∞: CUDA out of memory

–£–º–µ–Ω—å—à–∏—Ç–µ batch_size –≤ —Ñ–∞–π–ª–µ –æ–±—É—á–µ–Ω–∏—è (CONFIG —Å–ª–æ–≤–∞—Ä—å):
- ResNet-18: batch_size = 16
- Baseline: batch_size = 24
- ViT: batch_size = 8

### –°–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ –æ–±—É—á–∞–µ—Ç—Å—è

1. –£–º–µ–Ω—å—à–∏—Ç–µ epochs –≤ CONFIG (–º–æ–∂–Ω–æ –¥–æ 5-10)
2. –ü—Ä–æ–ø—É—Å—Ç–∏—Ç–µ ViT (—Å–∞–º–∞—è –º–µ–¥–ª–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å)
3. –û–±—É—á–∏—Ç–µ —Ç–æ–ª—å–∫–æ ResNet-18: `./train_resnet_fast.sh`

### –ù–∏–∑–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å

–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø—Ä–∏ –º–∞–ª–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —ç–ø–æ—Ö. –î–ª—è –ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
- –£–≤–µ–ª–∏—á—å—Ç–µ epochs –¥–æ 20-30
- –ù–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ 10-15 epochs

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
   ```bash
   python src/compare_primary_models.py
   ```

2. **–í—ã–±–µ—Ä–∏—Ç–µ –ª—É—á—à—É—é –º–æ–¥–µ–ª—å** (–æ–±—ã—á–Ω–æ ResNet-18)

3. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –±–æ—Ç–µ:**
   ```bash
   cp models/resnet18/best_model.pth models/primary_resnet18.pth
   ```

4. **–ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ –≠—Ç–∞–ø—É 4:** –û–±—É—á–µ–Ω–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
   - U-Net –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å–µ—Ç—á–∞—Ç–∫–∏
   - YOLO –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ –∫–ª–µ—Ç–æ–∫ –∫—Ä–æ–≤–∏
   - CNN –¥–ª—è CIFAR-10

---

## –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ–ª–∏

–ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –º–æ–¥–µ–ª—å:

```python
import torch
from torchvision import models
import torch.nn as nn

# –ó–∞–≥—Ä—É–∑–∫–∞
checkpoint = torch.load('models/resnet18/best_model.pth')
model = models.resnet18(weights=None)
model.fc = nn.Linear(512, 3)
model.load_state_dict(checkpoint['model_state_dict'])
model.eval()

# –ü—Ä–æ–≤–µ—Ä–∫–∞
print(f"Val Accuracy: {checkpoint['val_acc']:.4f}")
print(f"Val F1-Score: {checkpoint['val_f1']:.4f}")
print(f"Classes: {checkpoint['class_names']}")
```

---

**–£–¥–∞—á–∏ –≤ –æ–±—É—á–µ–Ω–∏–∏! üöÄ**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—á–Ω–∏—Ç–µ —Å `./train_resnet_fast.sh` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
